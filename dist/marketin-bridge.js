(function(){"use strict";const I="marketinParams",u=typeof window<"u",p=()=>{var i;if(!u)return{};try{const e=(i=window.sessionStorage)==null?void 0:i.getItem(I);return e?JSON.parse(e):{}}catch(e){return console.warn("[MarketIn Demo] Unable to read stored params",e),{}}},M=i=>{var e;if(u)try{(e=window.sessionStorage)==null||e.setItem(I,JSON.stringify(i))}catch(t){console.warn("[MarketIn Demo] Unable to persist params",t)}},h=()=>{if(!u)return{};const i=p(),e=new URLSearchParams(window.location.search??""),t={};if(e.has("aid")&&(t.aid=e.get("aid")??void 0),e.has("cid")&&(t.cid=e.get("cid")??void 0),e.has("pid")&&(t.pid=e.get("pid")??void 0),Object.keys(t).length>0){const n={...i,...t};return M(n),n}return i},d=i=>{if(i==null||i==="")return;const e=Number(i);return Number.isFinite(e)?e:void 0},g=()=>u?window.__marketInBridgeConfig??{}:{},C=(i={})=>{const t={...g(),...i},n=r=>{const a=d(r);return a===void 0?void 0:a};return{brandId:n(t.brandId),campaignId:n(t.campaignId),affiliateId:n(t.affiliateId),defaultCampaignId:n(t.defaultCampaignId),defaultAffiliateId:n(t.defaultAffiliateId),apiEndpoint:t.apiEndpoint||"https://api.marketin.now/api/v1",debug:typeof t.debug=="boolean"?t.debug:!!(g().debug??!0)}},D=()=>{if(!u||window.__marketInEventsBound)return;const i=(t,n)=>{window.__marketInDebug&&console.info(`[MarketIn Demo] ${t}`,n)},e=(t,n)=>{window.addEventListener(t,r=>{n(r.detail??{})})};e("marketin:affiliate-click",t=>{var n,r;i("Affiliate Click",t),(r=(n=window.MarketIn)==null?void 0:n.trackAffiliateClick)==null||r.call(n,t)}),e("marketin:conversion",t=>{var m,E;i("Purchase Conversion (raw)",t);const n=Array.isArray(t)?t[0]:t,r=p(),a=(n==null?void 0:n.amount)??(n==null?void 0:n.value)??(n==null?void 0:n.price);let o=Number(a);if(typeof a=="string"){const y=a.replace(/,/g,"").trim();o=Number.parseFloat(y)}const c=(r==null?void 0:r.pid)??(r==null?void 0:r.productId)??(n==null?void 0:n.productId)??(n==null?void 0:n.id),k=c!=null?String(c).trim():"",S=d(n==null?void 0:n.affiliateId)??d(r==null?void 0:r.aid),A=d(n==null?void 0:n.campaignId)??d(r==null?void 0:r.cid);if(!Number.isFinite(o)||!k){console.error("[MarketIn Demo] Invalid conversion payload. value/productId required.",{rawAmount:a,value:o,productId:k,payload:n,detail:t,storedParams:r});return}const f={eventType:"purchase",value:o,currency:(n==null?void 0:n.currency)||"USD",conversionRef:n==null?void 0:n.orderId,productId:k,metadata:{productName:n==null?void 0:n.name,purchasedAt:n==null?void 0:n.purchasedAt}};S!==void 0&&(f.affiliateId=S),A!==void 0&&(f.campaignId=A),i("Purchase Conversion (mapped)",f),(E=(m=window.MarketIn)==null?void 0:m.trackConversion)==null||E.call(m,f)}),e("marketin:subscription",t=>{var n,r;i("Subscription detail",t),(r=(n=window.MarketIn)==null?void 0:n.trackSubscription)==null||r.call(n,t)}),window.__marketInEventsBound=!0},w=i=>{!i||i.dataset.marketinSubscriptionBound==="true"||(i.dataset.marketinSubscriptionBound="true",i.addEventListener("submit",e=>{var t,n;(n=(t=window.MarketIn)==null?void 0:t.handleSubscriptionSubmit)==null||n.call(t,e)}))},O=(i,e)=>{const t={},n=i.getAttribute(e);if(n&&n!=="")try{const r=JSON.parse(n);Object.assign(t,r)}catch(r){console.warn("[MarketIn Demo] Invalid JSON in attribute",e,r)}return Object.entries(i.dataset).forEach(([r,a])=>{if(!r.toLowerCase().startsWith("marketin"))return;const o=r.replace(/^marketin/i,"");if(!o||o.toLowerCase()==="click"||o.toLowerCase()==="conversion")return;const s=o.charAt(0).toLowerCase()+o.slice(1);if(!(a==null||a==="")){if(/id$/i.test(s)||/amount|value|price$/i.test(s)){const c=d(a);t[s]=c??a;return}t[s]=a}}),t},B=(i,e)=>{u&&window.dispatchEvent(new CustomEvent(i,{detail:e}))},b=(i,e,t,n="click")=>{u&&document.querySelectorAll(i).forEach(r=>{const a=`${t.replace(/[^a-z0-9]/gi,"")}Bound`;if(r.dataset[a]==="true")return;const o=()=>{const c=O(r,e);t==="marketin:affiliate-click"&&!c.clickedAt&&(c.clickedAt=new Date().toISOString()),t==="marketin:conversion"&&!c.purchasedAt&&(c.purchasedAt=new Date().toISOString()),B(t,c)},s=r.dataset.marketinEvent??n;r.addEventListener(s,o),r.dataset[a]="true"})},_=()=>{if(!u)return;b("[data-marketin-click]","data-marketin-click","marketin:affiliate-click"),b("[data-marketin-conversion]","data-marketin-conversion","marketin:conversion"),document.querySelectorAll('form[data-marketin="subscription"]').forEach(e=>w(e));const i=document.getElementById("subscription-test-form");i&&w(i)},N=i=>{var a,o,s;if(!u)return;const e=C(i);window.__marketInBootstrapOptions=e,window.__marketInDebug=e.debug;const t=h(),n=d(t.aid)??e.affiliateId??e.defaultAffiliateId,r=d(t.cid)??e.campaignId??e.defaultCampaignId;if(e.brandId===void 0||e.brandId===null){console.error("[MarketIn Demo] Missing brandId. Provide brandId via config, environment variables, or @marketinScripts override.");return}typeof window.MarketIn<"u"&&!window.__marketInInitialized&&(window.MarketIn.init({brandId:e.brandId,campaignId:r,affiliateId:n,apiEndpoint:e.apiEndpoint,debug:e.debug}),e.debug&&(console.log("âœ… MarketIn SDK initialized",{brandId:e.brandId,campaignId:r,affiliateId:n,apiEndpoint:e.apiEndpoint}),console.log("ðŸ“Š SDK Status:",(o=(a=window.MarketIn).getStatus)==null?void 0:o.call(a)),console.log("ðŸ“Œ MarketIn Params:",{affiliateId:n,campaignId:r,stored:t})),window.__marketInInitialized=!0),D(),_(),(s=window.MarketIn)!=null&&s.trackPageView&&(window.MarketIn.trackPageView(),e.debug&&console.log("ðŸ”„ Page view tracked"))};let v=!1,l={};const L=(i={})=>{l={...l,...i};const e=()=>N(l);v?e():(v=!0,document.readyState==="loading"?document.addEventListener("DOMContentLoaded",e):e(),document.addEventListener("livewire:load",e),document.addEventListener("livewire:navigated",()=>{e()}))},P=()=>typeof document>"u"?null:document.currentScript?document.currentScript:Array.from(document.querySelectorAll("script")).reverse().find(e=>e.src&&e.src.includes("marketin-bridge"))??null;L((()=>{const i=P();if(!i)return{};const e=i.dataset??{},t={};if(e.marketinBrand&&(t.brandId=d(e.marketinBrand)??e.marketinBrand),e.marketinCampaign&&(t.campaignId=d(e.marketinCampaign)??e.marketinCampaign),e.marketinAffiliate&&(t.affiliateId=d(e.marketinAffiliate)??e.marketinAffiliate),e.marketinApi&&(t.apiEndpoint=e.marketinApi),e.marketinDebug!==void 0&&(t.debug=e.marketinDebug!=="false"),e.marketinConfig)try{const n=JSON.parse(e.marketinConfig);Object.assign(t,n)}catch(n){console.warn("[MarketIn Demo] Unable to parse data-marketin-config JSON",n)}return t})())})();
//# sourceMappingURL=marketin-bridge.js.map
