{"version":3,"file":"marketin-bridge.js","sources":["../src/resources/js/marketin/core.js","../src/resources/js/marketin-bridge.js"],"sourcesContent":["const MARKETIN_PARAM_KEY = 'marketinParams';\n\nconst isBrowser = typeof window !== 'undefined';\n\nconst readStoredMarketInParams = () => {\n\tif (!isBrowser) {\n\t\treturn {};\n\t}\n\n\ttry {\n\t\tconst raw = window.sessionStorage?.getItem(MARKETIN_PARAM_KEY);\n\t\treturn raw ? JSON.parse(raw) : {};\n\t} catch (error) {\n\t\tconsole.warn('[MarketIn Demo] Unable to read stored params', error);\n\t\treturn {};\n\t}\n};\n\nconst writeStoredMarketInParams = (params) => {\n\tif (!isBrowser) {\n\t\treturn;\n\t}\n\n\ttry {\n\t\twindow.sessionStorage?.setItem(MARKETIN_PARAM_KEY, JSON.stringify(params));\n\t} catch (error) {\n\t\tconsole.warn('[MarketIn Demo] Unable to persist params', error);\n\t}\n};\n\nconst syncMarketInParamsFromUrl = () => {\n\tif (!isBrowser) {\n\t\treturn {};\n\t}\n\n\tconst current = readStoredMarketInParams();\n\tconst searchParams = new URLSearchParams(window.location.search ?? '');\n\tconst updates = {};\n\n\tif (searchParams.has('aid')) {\n\t\tupdates.aid = searchParams.get('aid') ?? undefined;\n\t}\n\n\tif (searchParams.has('cid')) {\n\t\tupdates.cid = searchParams.get('cid') ?? undefined;\n\t}\n\n\tif (searchParams.has('pid')) {\n\t\tupdates.pid = searchParams.get('pid') ?? undefined;\n\t}\n\n\tif (Object.keys(updates).length > 0) {\n\t\tconst merged = { ...current, ...updates };\n\t\twriteStoredMarketInParams(merged);\n\t\treturn merged;\n\t}\n\n\treturn current;\n};\n\nconst parseNumericId = (value) => {\n\tif (value === undefined || value === null || value === '') {\n\t\treturn undefined;\n\t}\n\n\tconst numeric = Number(value);\n\treturn Number.isFinite(numeric) ? numeric : undefined;\n};\n\nconst readBridgeConfig = () => {\n\tif (!isBrowser) {\n\t\treturn {};\n\t}\n\n\treturn window.__marketInBridgeConfig ?? {};\n};\n\nconst resolveBootstrapOptions = (overrides = {}) => {\n\tconst globalConfig = readBridgeConfig();\n\tconst combined = { ...globalConfig, ...overrides };\n\n\tconst toNumberOrUndefined = (value) => {\n\t\tconst numeric = parseNumericId(value);\n\t\treturn numeric === undefined ? undefined : numeric;\n\t};\n\n\treturn {\n\t\tbrandId: toNumberOrUndefined(combined.brandId),\n\t\tcampaignId: toNumberOrUndefined(combined.campaignId),\n\t\taffiliateId: toNumberOrUndefined(combined.affiliateId),\n\t\tdefaultCampaignId: toNumberOrUndefined(combined.defaultCampaignId),\n\t\tdefaultAffiliateId: toNumberOrUndefined(combined.defaultAffiliateId),\n\t\tapiEndpoint: combined.apiEndpoint || 'https://api.marketin.now/api/v1',\n\t\tdebug: typeof combined.debug === 'boolean' ? combined.debug : Boolean(readBridgeConfig().debug ?? true),\n\t};\n};\n\nconst bindMarketInEvents = () => {\n\tif (!isBrowser || window.__marketInEventsBound) {\n\t\treturn;\n\t}\n\n\tconst logEvent = (label, detail) => {\n\t\tif (!window.__marketInDebug) {\n\t\t\treturn;\n\t\t}\n\n\t\tconsole.info(`[MarketIn Demo] ${label}`, detail);\n\t};\n\n\tconst subscribeTo = (eventName, callback) => {\n\t\twindow.addEventListener(eventName, (event) => {\n\t\t\tcallback(event.detail ?? {});\n\t\t});\n\t};\n\n\tsubscribeTo('marketin:affiliate-click', (detail) => {\n\t\tlogEvent('Affiliate Click', detail);\n\t\twindow.MarketIn?.trackAffiliateClick?.(detail);\n\t});\n\n\tsubscribeTo('marketin:conversion', (detail) => {\n\t\tlogEvent('Purchase Conversion (raw)', detail);\n\n\t\tconst payload = Array.isArray(detail) ? detail[0] : detail;\n\t\tconst storedParams = readStoredMarketInParams();\n\n\t\tconst rawAmount = payload?.amount ?? payload?.value ?? payload?.price;\n\t\tlet value = Number(rawAmount);\n\t\tif (typeof rawAmount === 'string') {\n\t\t\tconst cleaned = rawAmount.replace(/,/g, '').trim();\n\t\t\tvalue = Number.parseFloat(cleaned);\n\t\t}\n\n\t\tconst storedProductId = storedParams?.pid ?? storedParams?.productId;\n\t\tconst productIdCandidate = storedProductId ?? payload?.productId ?? payload?.id;\n\t\tconst productId = productIdCandidate !== undefined && productIdCandidate !== null ? String(productIdCandidate).trim() : '';\n\n\t\tconst affiliateId = parseNumericId(payload?.affiliateId) ?? parseNumericId(storedParams?.aid);\n\t\tconst campaignId = parseNumericId(payload?.campaignId) ?? parseNumericId(storedParams?.cid);\n\n\t\tif (!Number.isFinite(value) || !productId) {\n\t\t\tconsole.error('[MarketIn Demo] Invalid conversion payload. value/productId required.', {\n\t\t\t\trawAmount,\n\t\t\t\tvalue,\n\t\t\t\tproductId,\n\t\t\t\tpayload,\n\t\t\t\tdetail,\n\t\t\t\tstoredParams,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst conversionData = {\n\t\t\teventType: 'purchase',\n\t\t\tvalue,\n\t\t\tcurrency: payload?.currency || 'USD',\n\t\t\tconversionRef: payload?.orderId,\n\t\t\tproductId,\n\t\t\tmetadata: {\n\t\t\t\tproductName: payload?.name,\n\t\t\t\tpurchasedAt: payload?.purchasedAt,\n\t\t\t},\n\t\t};\n\n\t\tif (affiliateId !== undefined) {\n\t\t\tconversionData.affiliateId = affiliateId;\n\t\t}\n\n\t\tif (campaignId !== undefined) {\n\t\t\tconversionData.campaignId = campaignId;\n\t\t}\n\n\t\tlogEvent('Purchase Conversion (mapped)', conversionData);\n\t\twindow.MarketIn?.trackConversion?.(conversionData);\n\t});\n\n\tsubscribeTo('marketin:subscription', (detail) => {\n\t\tlogEvent('Subscription detail', detail);\n\t\twindow.MarketIn?.trackSubscription?.(detail);\n\t});\n\n\twindow.__marketInEventsBound = true;\n};\n\nconst bindSubscriptionForm = (form) => {\n\tif (!form || form.dataset.marketinSubscriptionBound === 'true') {\n\t\treturn;\n\t}\n\n\tform.dataset.marketinSubscriptionBound = 'true';\n\tform.addEventListener('submit', (event) => {\n\t\twindow.MarketIn?.handleSubscriptionSubmit?.(event);\n\t});\n};\n\nconst resolvePayloadFromElement = (element, markerAttribute) => {\n\tconst payload = {};\n\n\tconst raw = element.getAttribute(markerAttribute);\n\tif (raw && raw !== '') {\n\t\ttry {\n\t\t\tconst parsed = JSON.parse(raw);\n\t\t\tObject.assign(payload, parsed);\n\t\t} catch (error) {\n\t\t\tconsole.warn('[MarketIn Demo] Invalid JSON in attribute', markerAttribute, error);\n\t\t}\n\t}\n\n\tObject.entries(element.dataset).forEach(([key, value]) => {\n\t\tif (!key.toLowerCase().startsWith('marketin')) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst normalized = key.replace(/^marketin/i, '');\n\t\tif (!normalized || normalized.toLowerCase() === 'click' || normalized.toLowerCase() === 'conversion') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst formattedKey = normalized.charAt(0).toLowerCase() + normalized.slice(1);\n\n\t\tif (value === undefined || value === null || value === '') {\n\t\t\treturn;\n\t\t}\n\n\t\tif (/id$/i.test(formattedKey) || /amount|value|price$/i.test(formattedKey)) {\n\t\t\tconst maybeNumber = parseNumericId(value);\n\t\t\tpayload[formattedKey] = maybeNumber ?? value;\n\t\t\treturn;\n\t\t}\n\n\t\tpayload[formattedKey] = value;\n\t});\n\n\treturn payload;\n};\n\nconst dispatchMarketInEvent = (eventName, payload) => {\n\tif (!isBrowser) {\n\t\treturn;\n\t}\n\n\twindow.dispatchEvent(new CustomEvent(eventName, { detail: payload }));\n};\n\nconst bindDeclarativeTarget = (selector, markerAttribute, eventName, defaultListenerEvent = 'click') => {\n\tif (!isBrowser) {\n\t\treturn;\n\t}\n\n\tdocument.querySelectorAll(selector).forEach((element) => {\n\t\tconst boundKey = `${eventName.replace(/[^a-z0-9]/gi, '')}Bound`;\n\t\tif (element.dataset[boundKey] === 'true') {\n\t\t\treturn;\n\t\t}\n\n\t\tconst listener = () => {\n\t\t\tconst payload = resolvePayloadFromElement(element, markerAttribute);\n\t\t\tif (eventName === 'marketin:affiliate-click' && !payload.clickedAt) {\n\t\t\t\tpayload.clickedAt = new Date().toISOString();\n\t\t\t}\n\n\t\t\tif (eventName === 'marketin:conversion' && !payload.purchasedAt) {\n\t\t\t\tpayload.purchasedAt = new Date().toISOString();\n\t\t\t}\n\t\t\tdispatchMarketInEvent(eventName, payload);\n\t\t};\n\n\t\tconst listenEvent = element.dataset.marketinEvent ?? defaultListenerEvent;\n\t\telement.addEventListener(listenEvent, listener);\n\t\telement.dataset[boundKey] = 'true';\n\t});\n};\n\nconst attachDeclarativeHooks = () => {\n\tif (!isBrowser) {\n\t\treturn;\n\t}\n\n\tbindDeclarativeTarget('[data-marketin-click]', 'data-marketin-click', 'marketin:affiliate-click');\n\tbindDeclarativeTarget('[data-marketin-conversion]', 'data-marketin-conversion', 'marketin:conversion');\n\tdocument.querySelectorAll('form[data-marketin=\"subscription\"]').forEach((form) => bindSubscriptionForm(form));\n\n\tconst legacyForm = document.getElementById('subscription-test-form');\n\tif (legacyForm) {\n\t\tbindSubscriptionForm(legacyForm);\n\t}\n};\n\nconst registerMarketInBridge = (options) => {\n\tif (!isBrowser) {\n\t\treturn;\n\t}\n\n\tconst resolved = resolveBootstrapOptions(options);\n\twindow.__marketInBootstrapOptions = resolved;\n\twindow.__marketInDebug = resolved.debug;\n\n\tconst effectiveParams = syncMarketInParamsFromUrl();\n\tconst affiliateId = parseNumericId(effectiveParams.aid) ?? resolved.affiliateId ?? resolved.defaultAffiliateId;\n\tconst campaignId = parseNumericId(effectiveParams.cid) ?? resolved.campaignId ?? resolved.defaultCampaignId;\n\n\tif (resolved.brandId === undefined || resolved.brandId === null) {\n\t\tconsole.error('[MarketIn Demo] Missing brandId. Provide brandId via config, environment variables, or @marketinScripts override.');\n\t\treturn;\n\t}\n\n\tif (typeof window.MarketIn !== 'undefined' && !window.__marketInInitialized) {\n\t\twindow.MarketIn.init({\n\t\t\tbrandId: resolved.brandId,\n\t\t\tcampaignId,\n\t\t\taffiliateId,\n\t\t\tapiEndpoint: resolved.apiEndpoint,\n\t\t\tdebug: resolved.debug,\n\t\t});\n\n\t\tif (resolved.debug) {\n\t\t\tconsole.log('âœ… MarketIn SDK initialized', {\n\t\t\t\tbrandId: resolved.brandId,\n\t\t\t\tcampaignId,\n\t\t\t\taffiliateId,\n\t\t\t\tapiEndpoint: resolved.apiEndpoint,\n\t\t\t});\n\t\t\tconsole.log('ðŸ“Š SDK Status:', window.MarketIn.getStatus?.());\n\t\t\tconsole.log('ðŸ“Œ MarketIn Params:', { affiliateId, campaignId, stored: effectiveParams });\n\t\t}\n\n\t\twindow.__marketInInitialized = true;\n\t}\n\n\tbindMarketInEvents();\n\tattachDeclarativeHooks();\n\n\tif (window.MarketIn?.trackPageView) {\n\t\twindow.MarketIn.trackPageView();\n\t\tif (resolved.debug) {\n\t\t\tconsole.log('ðŸ”„ Page view tracked');\n\t\t}\n\t}\n};\n\nlet listenersBound = false;\nlet latestOptions = {};\n\nconst bootstrapMarketInBridge = (options = {}) => {\n\tlatestOptions = { ...latestOptions, ...options };\n\n\tconst execute = () => registerMarketInBridge(latestOptions);\n\n\tif (!listenersBound) {\n\t\tlistenersBound = true;\n\n\t\tif (document.readyState === 'loading') {\n\t\t\tdocument.addEventListener('DOMContentLoaded', execute);\n\t\t} else {\n\t\t\texecute();\n\t\t}\n\n\t\tdocument.addEventListener('livewire:load', execute);\n\t\tdocument.addEventListener('livewire:navigated', () => {\n\t\t\texecute();\n\t\t});\n\t} else {\n\t\texecute();\n\t}\n};\n\nexport {\n\tbootstrapMarketInBridge,\n\tresolveBootstrapOptions,\n\tregisterMarketInBridge,\n\tparseNumericId,\n\tattachDeclarativeHooks,\n};","import { bootstrapMarketInBridge, parseNumericId } from './marketin/core';\n\nconst locateCurrentScript = () => {\n\tif (typeof document === 'undefined') {\n\t\treturn null;\n\t}\n\n\tif (document.currentScript) {\n\t\treturn document.currentScript;\n\t}\n\n\tconst scripts = Array.from(document.querySelectorAll('script'));\n\treturn scripts.reverse().find((script) => script.src && script.src.includes('marketin-bridge')) ?? null;\n};\n\nconst resolveOptionsFromAttributes = () => {\n\tconst script = locateCurrentScript();\n\tif (!script) {\n\t\treturn {};\n\t}\n\n\tconst dataset = script.dataset ?? {};\n\tconst options = {};\n\n\tif (dataset.marketinBrand) {\n\t\toptions.brandId = parseNumericId(dataset.marketinBrand) ?? dataset.marketinBrand;\n\t}\n\n\tif (dataset.marketinCampaign) {\n\t\toptions.campaignId = parseNumericId(dataset.marketinCampaign) ?? dataset.marketinCampaign;\n\t}\n\n\tif (dataset.marketinAffiliate) {\n\t\toptions.affiliateId = parseNumericId(dataset.marketinAffiliate) ?? dataset.marketinAffiliate;\n\t}\n\n\tif (dataset.marketinApi) {\n\t\toptions.apiEndpoint = dataset.marketinApi;\n\t}\n\n\tif (dataset.marketinDebug !== undefined) {\n\t\toptions.debug = dataset.marketinDebug !== 'false';\n\t}\n\n\tif (dataset.marketinConfig) {\n\t\ttry {\n\t\t\tconst parsed = JSON.parse(dataset.marketinConfig);\n\t\t\tObject.assign(options, parsed);\n\t\t} catch (error) {\n\t\t\tconsole.warn('[MarketIn Demo] Unable to parse data-marketin-config JSON', error);\n\t\t}\n\t}\n\n\treturn options;\n};\n\nbootstrapMarketInBridge(resolveOptionsFromAttributes());"],"names":["MARKETIN_PARAM_KEY","isBrowser","readStoredMarketInParams","raw","_a","error","writeStoredMarketInParams","params","syncMarketInParamsFromUrl","current","searchParams","updates","merged","parseNumericId","value","numeric","readBridgeConfig","resolveBootstrapOptions","overrides","combined","toNumberOrUndefined","bindMarketInEvents","logEvent","label","detail","subscribeTo","eventName","callback","event","_b","payload","storedParams","rawAmount","cleaned","productIdCandidate","productId","affiliateId","campaignId","conversionData","bindSubscriptionForm","form","resolvePayloadFromElement","element","markerAttribute","parsed","key","normalized","formattedKey","maybeNumber","dispatchMarketInEvent","bindDeclarativeTarget","selector","defaultListenerEvent","boundKey","listener","listenEvent","attachDeclarativeHooks","legacyForm","registerMarketInBridge","options","resolved","effectiveParams","_c","listenersBound","latestOptions","bootstrapMarketInBridge","execute","locateCurrentScript","script","dataset"],"mappings":"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"}